<!DOCTYPE html>
<html>
<head>
    <title>KubeMind Brain - Agent Stream</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; background-color: #121212; color: #e0e0e0; }
        h1 { color: #4db8ff; }
        #messages { list-style-type: none; padding: 0; margin-top: 20px; font-family: 'Consolas', monospace; font-size: 14px; }
        .message-item { background-color: #1e1e1e; padding: 10px; border-left: 3px solid #4db8ff; margin-bottom: 8px; white-space: pre-wrap; word-wrap: break-word; }
        .message-item:first-child { border-left-color: #28a745; }
        .status { margin-top: 10px; font-style: italic; color: #888; }
    </style>
</head>
<body>
    <h1>KubeMind Brain - Agent Stream</h1>
    <div id="status" class="status">Connecting...</div>
    <ul id="messages"></ul>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/agenthub")
            .configureLogging(signalR.LogLevel.Information)
            .build();

        const statusDiv = document.getElementById("status");
        const messagesUl = document.getElementById("messages");

        async function start() {
            try {
                await connection.start();
                console.log("SignalR Connected.");
                statusDiv.textContent = "Connected. Waiting for incident...";
            } catch (err) {
                console.error(err);
                statusDiv.textContent = "Connection failed. Retrying in 5 seconds...";
                setTimeout(start, 5000);
            }
        };

        connection.onclose(async () => {
            statusDiv.textContent = "Connection lost. Reconnecting...";
            await start();
        });

        connection.on("ReceiveMessage", (message) => {
            const li = document.createElement("li");
            li.className = "message-item";
            li.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            messagesUl.prepend(li);
        });

        start();
    </script>
</body>
</html>
